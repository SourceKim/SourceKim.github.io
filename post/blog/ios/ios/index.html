<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>iOS æ‚è®° - Kim's Blog</title><meta name=description content="è®°å½• iOS å¸¸ç”¨çŸ¥è¯†ç‚¹"><meta name=author content="Kim"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Kim\x27s Blog","url":"https:\/\/www.uiimage.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.uiimage.com\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.uiimage.com\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.uiimage.com\/post\/blog\/ios\/ios\/","name":"I o s æ‚è®°"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Kim"},"headline":"iOS æ‚è®°","description":"è®°å½• iOS å¸¸ç”¨çŸ¥è¯†ç‚¹\n","inLanguage":"en","wordCount":1558,"datePublished":"2018-05-02T03:32:24","dateModified":"2018-05-02T03:32:24","image":"https:\/\/www.uiimage.com\/img\/avatar.JPG","keywords":["iOS"],"mainEntityOfPage":"https:\/\/www.uiimage.com\/post\/blog\/ios\/ios\/","publisher":{"@type":"Organization","name":"https:\/\/www.uiimage.com\/","logo":{"@type":"ImageObject","url":"https:\/\/www.uiimage.com\/img\/avatar.JPG","height":60,"width":60}}}</script><meta property="og:title" content="iOS æ‚è®°"><meta property="og:description" content="è®°å½• iOS å¸¸ç”¨çŸ¥è¯†ç‚¹"><meta property="og:image" content="https://www.uiimage.com/img/avatar.JPG"><meta property="og:url" content="https://www.uiimage.com/post/blog/ios/ios/"><meta property="og:type" content="website"><meta property="og:site_name" content="Kim's Blog"><meta name=twitter:title content="iOS æ‚è®°"><meta name=twitter:description content="è®°å½• iOS å¸¸ç”¨çŸ¥è¯†ç‚¹"><meta name=twitter:image content="https://www.uiimage.com/img/avatar.JPG"><meta name=twitter:card content="summary"><link href=https://www.uiimage.com/img/avatar.JPG rel=icon type=image/x-icon><meta name=generator content="Hugo 0.69.2"><link rel=alternate href=https://www.uiimage.com/index.xml type=application/rss+xml title="Kim's Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.uiimage.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.uiimage.com/css/syntax.css><link rel=stylesheet href=https://www.uiimage.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://www.uiimage.com/>Kim's Blog</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li><a title=Tags href=/tags>Tags</a></li><li><a title=About href=/page/about/>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Kim's Blog" href=https://www.uiimage.com/><img class=avatar-img src=https://www.uiimage.com/img/avatar.JPG alt="Kim's Blog"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>iOS æ‚è®°</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on May 2, 2018
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1558&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Kim</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>è®°å½• iOS å¸¸ç”¨çŸ¥è¯†ç‚¹</p><h2 id=1-é™¤äº†-nsobject-ä¹‹å¤–è¿˜æœ‰ä»€ä¹ˆåŸºç±»>1. é™¤äº† NSObject ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆåŸºç±»ï¼Ÿ</h2><p>NSProxy</p><hr><h2 id=2-nsproxy-æ˜¯ä»€ä¹ˆ>2. NSProxy æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><p><code>NSProxy</code> æ˜¯å’Œ <code>NSObject</code> åŒçº§çš„ä¸€ä¸ªç±»ï¼Œå¯ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿç±»ï¼Œå®ƒåªæ˜¯å®ç°äº† <code>&lt;NSObject> </code>çš„åè®®</p></li><li><p>æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äº <strong>æ¶ˆæ¯è½¬å‘</strong></p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Objective-C data-lang=Objective-C>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>forwardInvocation:</span>(NSInvocation <span style=color:#f92672>*</span>)anInvocation;

- (NSMethodSignature <span style=color:#f92672>*</span>)<span style=color:#a6e22e>methodSignatureForSelector:</span>(<span style=color:#66d9ef>SEL</span>)sel;
</code></pre></div><ul><li><code>NSProxy</code> æ²¡æœ‰ <code>init:</code> çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½è¿™æ ·è·å–å®ƒçš„å®ä¾‹ï¼š</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Objective-C data-lang=Objective-C>MyProxy <span style=color:#f92672>*</span>proxy <span style=color:#f92672>=</span> [MyProxy alloc];
</code></pre></div><ul><li><p>åº”ç”¨ï¼š <strong>é˜²æ­¢ NSTimer å¾ªç¯å¼•ç”¨</strong>ï¼š</p><ul><li><ol><li>åˆ›å»ºä¸€ä¸ª <code>WeakProxy</code> æ¥ä»£ç† timer çš„æŒæœ‰å¯¹è±¡ ï¼ˆæ³¨æ„è¿™ä¸ª <code>target</code> è¦ç”¨ <code>weak</code>ï¼‰</li></ol></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=color:#66d9ef>@interface</span> <span style=color:#a6e22e>WeakProxy</span> : <span style=color:#a6e22e>NSProxy</span>
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>weak</span>,<span style=color:#66d9ef>nonatomic</span>,<span style=color:#66d9ef>readonly</span>)<span style=color:#66d9ef>id</span> target;
+ (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>proxyWithTarget:</span>(<span style=color:#66d9ef>id</span>)target;
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithTarget:</span>(<span style=color:#66d9ef>id</span>)target;
<span style=color:#66d9ef>@end</span>

<span style=color:#66d9ef>@implementation</span> <span style=color:#a6e22e>WeakProxy</span>
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithTarget:</span>(<span style=color:#66d9ef>id</span>)target{
    _target <span style=color:#f92672>=</span> target;
    <span style=color:#66d9ef>return</span> self;
}
+ (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>proxyWithTarget:</span>(<span style=color:#66d9ef>id</span>)target{
    <span style=color:#66d9ef>return</span> [[self alloc] initWithTarget:target];
}
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>forwardInvocation:</span>(NSInvocation <span style=color:#f92672>*</span>)invocation{
    <span style=color:#66d9ef>SEL</span> sel <span style=color:#f92672>=</span> [invocation selector];
    <span style=color:#66d9ef>if</span> ([self.target respondsToSelector:sel]) {
        [invocation invokeWithTarget:self.target];
    }
}
- (NSMethodSignature <span style=color:#f92672>*</span>)<span style=color:#a6e22e>methodSignatureForSelector:</span>(<span style=color:#66d9ef>SEL</span>)aSelector{
    <span style=color:#66d9ef>return</span> [self.target methodSignatureForSelector:aSelector];
}
- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>respondsToSelector:</span>(<span style=color:#66d9ef>SEL</span>)aSelector{
    <span style=color:#66d9ef>return</span> [self.target respondsToSelector:aSelector];
}
<span style=color:#66d9ef>@end</span>
</code></pre></div><ul><li><ol start=2><li>å°† timer çš„ <code>target</code> æŒ‡å‘è¯¥ proxy</li></ol></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc>self.timer <span style=color:#f92672>=</span> [NSTimer timerWithTimeInterval: <span style=color:#ae81ff>1</span>
                                     target:[WeakProxy proxyWithTarget:self]
                                   selector: <span style=color:#66d9ef>@selector</span>(timerInvoked:)
                                   userInfo: nil
                                    repeats: YES];
</code></pre></div></li></ul><hr><h2 id=3-instancetype--id-åŒºåˆ«>3. <code>instancetype</code> & <code>id</code> åŒºåˆ«ï¼š</h2><ul><li><p>ç±»å‹æ£€æŸ¥çš„åŒºåˆ«ï¼š</p><ul><li><p>åœ¨ ARC ä¸‹ï¼š <code>instancetype</code> ç”¨æ¥åœ¨ç¼–è¯‘æœŸç¡®å®šå®ä¾‹çš„ç±»å‹,è€Œä½¿ç”¨ <code>id</code> çš„è¯, ç¼–è¯‘å™¨ä¸æ£€æŸ¥ç±»å‹, è¿è¡Œæ—¶æ£€æŸ¥ç±»å‹ã€‚</p></li><li><p>åœ¨ MRC ä¸‹ï¼š <code>instancetype</code> & <code>id</code> éƒ½ä¸åšç±»å‹æ£€æŸ¥ã€‚</p></li></ul></li><li><p>ç”¨é€”åŒºåˆ«</p><ul><li><p><code>id</code> å¯ä»¥ä½œä¸ºæ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œä½† <code>instancetype</code> ä¸å¯ä»¥</p></li><li><p><code>instancetype</code> åªé€‚ç”¨äºåˆå§‹åŒ–æ–¹æ³•å’Œä¾¿åˆ©æ„é€ å™¨çš„è¿”å›å€¼ç±»å‹</p></li></ul><p>æ€»ç»“å°±æ˜¯ï¼š<code>id</code> å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ç±»å‹å’Œä»»ä½•çš„è¿”å›å€¼ç±»å‹ï¼›è€Œ <code>instancetype</code> åªèƒ½æ˜¯<strong>åˆå§‹åŒ–æ–¹æ³•å’Œä¾¿åˆ©æ„é€ å™¨çš„è¿”å›å€¼ç±»å‹</strong></p></li></ul><hr><h2 id=4-uibutton-ä¸å“åº”çš„åŸå› >4. <code>UIButton</code> ä¸å“åº”çš„åŸå› ï¼š</h2><ul><li>å®ƒçš„çˆ¶è§†å›¾æ²¡æœ‰å¼€å¯ ç”¨æˆ·äº¤äº’</li><li>é€æ˜åº¦ä¸º 0</li><li>æ”¶æ‹¾è¢«è¦†ç›–åœ¨å…¶ä¸Šé¢çš„ å­è§†å›¾ã€æˆ–è€…åŒçº§è§†å›¾ æ‹¦æˆªäº†</li><li>ç‚¹å‡»åœ°æ–¹çš„ point è¶…å‡ºäº†çˆ¶è§†å›¾çš„ frame</li></ul><hr><h2 id=5-ios-çš„-error-ä¸ºä»€ä¹ˆæ˜¯--åŒæŒ‡é’ˆ>5. iOS çš„ error ä¸ºä»€ä¹ˆæ˜¯ <code>**</code> åŒæŒ‡é’ˆï¼Ÿ</h2><p>å› ä¸ºå¤§å¤šæ•°çš„æ—¶å€™ï¼ŒiOS ä¼šåœ¨<strong>å†…éƒ¨å®ä¾‹åŒ–ä¸€ä¸ª <code>NSError</code> çš„å¯¹è±¡</strong>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆè¿›å»ï¼Œè®©å…¶åœ¨å†…éƒ¨æŒ‡å‘è¯¥å¯¹è±¡ã€‚</p><hr><h2 id=6-æ­»é”çš„äº§ç”ŸåŸå› >6. æ­»é”çš„äº§ç”ŸåŸå› ï¼Ÿ</h2><ul><li><ol><li>ç«äº‰å…¬å…±èµ„æº ï¼ˆ2 ä¸ªä»¥ä¸Šçš„è¿›ç¨‹éƒ½åœ¨äº‰å¤º<code>ä¸å¯å‰¥å¤ºèµ„æº</code>ï¼‰</li></ol></li><li><ol start=2><li>è¿›ç¨‹æ¨è¿›ä¸å½“ ï¼ˆç›¸äº’ç­‰å¾…ï¼‰</li></ol></li></ul><hr><h2 id=7-ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åŒæ­¥ä¼šæ­»é”>7. ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åŒæ­¥ä¼šæ­»é”</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>dispatch_sync(dispatch_get_main_queue(), <span style=color:#f92672>^</span>(<span style=color:#66d9ef>void</span>){
    NSLog(<span style=color:#e6db74>@&#34;print&#34;</span>); <span style=color:#75715e>// ä»»åŠ¡ 1
</span><span style=color:#75715e></span>});
NSLog(<span style=color:#e6db74>@&#34;a&#34;</span>); <span style=color:#75715e>// ä»»åŠ¡ 2
</span></code></pre></div><p>æ°¸è¿œä¸ä¼šæ‰“å° print å’Œ aï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><blockquote><p><a href=https://juejin.im/post/5b4d945ef265da0f9c6797f0>https://juejin.im/post/5b4d945ef265da0f9c6797f0</a></p></blockquote><hr><h2 id=8-ä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—>8. ä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ï¼Ÿ</h2><p>éƒ½æ˜¯é˜Ÿåˆ—ï¼Œå…·æœ‰ <code>FIFO</code> çš„ç‰¹æ€§</p><p>ä¸²è¡Œé˜Ÿåˆ—ï¼šéœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œï¼Œè€Œä¸”ä¼šæ ¹æ® <code>FIFO</code> å»é€‰å®šæ‰§è¡Œå“ªä¸ª</p><p>å¹¶å‘é˜Ÿåˆ—ï¼šå¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œä¹Ÿæ˜¯æ ¹æ® <code>FIFO</code> å»é€‰å®šæ‰§è¡Œå“ªä¸ªï¼Œä½†æ˜¯æ— éœ€ç­‰å¾…ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p><hr><h2 id=9-åŒæ­¥å’Œå¼‚æ­¥>9. åŒæ­¥å’Œå¼‚æ­¥ï¼Ÿ</h2><p>æ˜¯ GCD çš„ åŒæ­¥å’Œå¼‚æ­¥ï¼Œé’ˆå¯¹ä»»åŠ¡çš„æ‰§è¡Œè€Œè¨€çš„ï¼Œæè¿°çš„æ˜¯è¿™ä¸ª ä»»åŠ¡ ä¸ä¸Šä¸‹æ–‡çš„å…³ç³»ã€‚</p><p>åŒæ­¥ï¼šè°ƒç”¨å‡½æ•°æˆ–è€…ä»£ç å—çš„æ—¶å€™ï¼Œå¿…é¡»è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œï¼Œæ‰èƒ½æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p><p>å¼‚æ­¥ï¼šä¸ç®¡è°ƒç”¨çš„å‡½æ•°æˆ–è€…ä»£ç å—æœ‰æ²¡æœ‰æ‰§è¡Œå®Œï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><hr><h2 id=10-ios-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«>10. iOS è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h2><blockquote><p><a href=https://www.jianshu.com/p/ecb1a559f816>https://www.jianshu.com/p/ecb1a559f816</a></p></blockquote><hr><h2 id=11-id-å’Œ-nsobject-çš„åŒºåˆ«>11. <code>id</code> å’Œ <code>NSObject</code> çš„åŒºåˆ«</h2><p>ä¸¤ä¸ªç±»å‹éƒ½å«æœ‰ <code>Class isa</code>ï¼Œä½† <code>NSObject</code> åŒæ—¶åŒ…å«äº†ä¸€äº›å…¶å®ƒçš„æ–¹æ³•ï¼Œå¹¶éœ€è¦å®ç° <code>NSObject</code>åè®®ã€‚ æ‰€ä»¥ <code>NSObject</code> å¯ä»¥ç”¨idæ¥è¡¨ç¤ºã€‚ä½†<code> id</code> ä¸èƒ½ç”¨ <code>NSObject</code> æ¥è¡¨ç¤ºã€‚</p><p><code>id</code> å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒå¯ä»¥æŒ‡å‘çš„ç±»å‹ä¸ä»…é™äº <code>NSObject</code>ï¼Œå®ç°äº† <code>NSObject protocol</code> å³å¯ã€‚</p><p><code>NSObject*</code> å°±æ˜¯ <code>NSObject</code> ç±»å‹çš„æŒ‡é’ˆäº†ï¼Œå®ƒèŒƒå›´è¾ƒå°ã€‚</p><hr><h2 id=12-atomic-ä¸€å®šçº¿ç¨‹å®‰å…¨>12. <code>atomic</code> ä¸€å®šçº¿ç¨‹å®‰å…¨ï¼Ÿ</h2><p>ä¸æ˜¯ã€‚</p><p>çº¿ç¨‹å®‰å…¨çš„æ¦‚å¿µæ˜¯ï¼š <code>å¤šæ¡çº¿ç¨‹åŒæ—¶å·¥ä½œçš„æƒ…å†µä¸‹,é€šè¿‡è¿ç”¨çº¿ç¨‹é”,åŸå­æ€§ç­‰æ–¹æ³•é¿å…å¤šæ¡çº¿ç¨‹å› ä¸ºåŒæ—¶è®¿é—®åŒä¸€å¿«å†…å­˜é€ æˆçš„æ•°æ®é”™è¯¯æˆ–å†²çª</code></p><p>è€Œ <code>atomic</code> åªèƒ½æ˜¯ä¿è¯æ•°æ®åœ¨å­˜å–ï¼ˆ<code>getter & setter</code>) æ˜¯åŸå­æ€§çš„ï¼Œå¹¶ä¸èƒ½å®Œå…¨ç¬¦åˆçº¿ç¨‹å®‰å…¨çš„æ¦‚å¿µã€‚</p><p>æ¯”å¦‚ çº¿ç¨‹ a å…ˆå†™ï¼Œçº¿ç¨‹ b é‡Šæ”¾äº†è¯¥å±æ€§ï¼Œa å†å»è¯»è¿™ä¸ªå±æ€§çš„æ—¶å€™å°±ä¼š crashã€‚</p><hr><h2 id=13-load--initialize>13. <code>+load</code> & <code>+initialize</code></h2><p>éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨éƒ½åŠ äº†é”ï¼Œå› æ­¤ä¸åº”å†åœ¨å†…éƒ¨ä½¿ç”¨é”é˜²æ­¢é€ æˆæ­»é”</p><h3 id=è°ƒç”¨æ—¶æœº>è°ƒç”¨æ—¶æœº</h3><p><code>+load</code> åŠ è½½ç±»ï¼Œå‘ç”Ÿåœ¨ dyld é“¾æ¥çš„æ—¶å€™</p><p><code>+initialize</code> åˆå§‹åŒ–ç±»ï¼Œæ˜¯æ‡’åŠ è½½ï¼Œåœ¨ç±»é¦–æ¬¡ <strong>æ¥æ”¶ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹å‰</strong> ä¼šè¢«è°ƒç”¨</p><h3 id=è°ƒç”¨é¡ºåº>è°ƒç”¨é¡ºåº</h3><ul><li><p><code>+load</code></p><ul><li>çˆ¶ç±»å’Œå­ç±»éƒ½æœ‰ <code>+load</code>ï¼Œçˆ¶ç±»å…ˆè°ƒç”¨ï¼Œå†åˆ°å­ç±»</li><li>å­ç±»æ²¡æœ‰å®ç° <code>+load</code>ï¼Œä¸ä¼šè°ƒç”¨çˆ¶ç±»çš„</li><li>å…ˆè°ƒç”¨ç±»çš„ï¼Œå†è°ƒç”¨åˆ†ç±»ï¼ˆ<code>category</code>ï¼‰çš„</li><li>å¤šä¸ª <code>category</code> çš„è°ƒç”¨é¡ºåºï¼Œæ˜¯å’Œ <code>Compile Source</code> çš„è°ƒç”¨é¡ºåºä¸€è‡´</li><li>ç±»çš„ <code>+load</code> è°ƒç”¨é¡ºåºï¼Œæ˜¯å’Œ <code>Compile Source</code> çš„è°ƒç”¨é¡ºåºä¸€è‡´</li></ul><p>æ€»ç»“ï¼š</p><p>çˆ¶ç±» -> å­ç±» -> åˆ†ç±»</p><p>å­ç±»æ²¡å®ç°ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨çˆ¶ç±»çš„</p><p>é¡ºåºå’Œ <code>Compile Source</code> çš„è°ƒç”¨é¡ºåºä¸€è‡´</p></li><li><p><code>+initialize</code></p><ul><li>å½“å­ç±»æœªå®ç° <code>+initialize</code> æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„ï¼Œ</li><li>å­ç±»å®ç° <code>+initialize</code> æ–¹æ³•æ—¶,ä¼šè¦†ç›–çˆ¶ç±»çš„ ï¼ˆä½†æ˜¯å†…éƒ¨ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„ <code>+initialize</code>ï¼Œä¸éœ€è¦æˆ‘ä»¬æ˜¾å¼è°ƒç”¨ <code>[super initialize]</code>ï¼‰</li><li>å½“æœ‰å¤šä¸ª <code>category</code> éƒ½å®ç°äº† <code>+initialize</code> æ–¹æ³•,ä¼š <strong>è¦†ç›–</strong> ç±»ä¸­çš„æ–¹æ³•,åªæ‰§è¡Œä¸€ä¸ªï¼ˆ<code>Compile Sources</code> æœ€åä¸€ä¸ª <code>category</code> çš„ï¼‰</li></ul><p>æ³¨æ„ï¼š</p><p>å­ç±»å®ç°äº†ä¹‹åï¼Œä¼šè‡ªåŠ¨å…ˆè°ƒç”¨çˆ¶ç±»çš„ï¼Œä½†æ˜¯åˆ†ç±»ä¸ä¼š</p></li></ul><h3 id=åº”ç”¨åœºæ™¯>åº”ç”¨åœºæ™¯</h3><ul><li><p><code>+load</code> ä¸€èˆ¬ç”¨äº <strong>æ–¹æ³•ç½®æ¢</strong></p></li><li><p><code>+initialize</code> ä¸€èˆ¬ç”¨äº <strong>åˆå§‹åŒ–å…¨å±€å˜é‡æˆ–é™æ€å˜é‡</strong></p></li></ul><hr><h2 id=14-ä½¿ç”¨-copy-ä¿®é¥°-nsstringä¸ç”¨-strong>14. ä½¿ç”¨ <code>copy</code> ä¿®é¥° <code>NSString</code>ï¼Œä¸ç”¨ <code>strong</code>ï¼Ÿ</h2><p><code>strong</code> ä¿®é¥°ï¼šåªæ˜¯å°†å…¶å¼•ç”¨è®¡æ•° +1</p><p><code>copy</code> ä¿®é¥°ï¼šä¼šå°†å±æ€§æ‹·è´ä¸€ä»½, å†…å­˜åœ°å€å’ŒåŸæ¥çš„å€¼ä¸ä¸€æ ·</p><h3 id=ä½¿ç”¨-strong-ä¿®é¥°-nsstring-ä¼šå‘ç”Ÿä»€ä¹ˆ>â‘ ã€ä½¿ç”¨ <code>strong</code> ä¿®é¥° <code>NSString</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3><p>å› ä¸º iOS å¤šæ€çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>mutable</code> æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª <code>immutable</code> çš„å±æ€§ï¼Œå°±ä¼šå¯¼è‡´ <code>mutable</code> è¢«ä¿®æ”¹ä¼šè®© <code>immutable</code> çš„å€¼ä¹Ÿä¿®æ”¹ï¼Œå› ä¸ºä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ä¸€æ ·ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Objective-C data-lang=Objective-C><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>strong</span>) NSString <span style=color:#f92672>*</span> A; <span style=color:#75715e>// ä¸å¯å˜ A
</span><span style=color:#75715e></span>
NSMutableString <span style=color:#f92672>*</span> B <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;BBB&#34;</span>; <span style=color:#75715e>// å¯å˜ B
</span><span style=color:#75715e></span>

A <span style=color:#f92672>=</span> B;

B <span style=color:#f92672>=</span> <span style=color:#e6db74>@&#34;CCC&#34;</span>;

NSLog(<span style=color:#e6db74>@&#34;%@&#34;</span>, A);
</code></pre></div><p>æ­¤æ—¶ä¼šå‘ç°è¾“å‡º <code>B</code> ä¿®æ”¹åçš„å€¼ <code>CCC</code>, å› ä¸º <strong>A å’Œ B æŒ‡å‘çš„åœ°å€ç›¸åŒ</strong></p><p>è‹¥ä½¿ç”¨ <code>copy</code> ä¿®é¥° <code>A</code>ï¼Œåˆ™è¿˜æ˜¯è¾“å‡º <code>BBB</code>ï¼Œå› ä¸º <strong>A å’Œ B æŒ‡å‘çš„åœ°å€ä¸ä¸€æ ·</strong></p><h3 id=ä½¿ç”¨-copy-ä¿®é¥°-nsmutablearray-ä¼šå‘ç”Ÿä»€ä¹ˆ>â‘¡ã€ä½¿ç”¨ <code>copy</code> ä¿®é¥° <code>NSMutableArray</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3><p>åœ¨è°ƒç”¨å…¶ å¯å˜ç›¸å…³çš„å‡½æ•°ï¼ˆå¦‚ <code>append:</code>ï¼‰ ä¼šå´©æºƒï¼Œå´©æºƒåŸå› æ˜¯ <code>unrecognized selector</code>ã€‚</p><p>å› ä¸ºç”± 15. å¯¹ å¯å˜ & ä¸å¯å˜ å¯¹è±¡è°ƒç”¨ <code>copy</code> & <code>mutableCopy</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ç¬¬äºŒä¸ªç»“è®ºå¯ä»¥å¾—çŸ¥ï¼šè°ƒç”¨äº† <code>copy</code> ä¼šè¿”å›ä¸€ä¸ª <strong>ä¸å¯å˜å¯¹è±¡ï¼Œå³ <code>NSArray</code></strong>ï¼Œä»–æ˜¯æ²¡æœ‰ <code>append:</code> æ–¹æ³•çš„ã€‚</p><hr><h2 id=15-å¯¹-å¯å˜--ä¸å¯å˜-å¯¹è±¡è°ƒç”¨-copy--mutablecopy-ä¼šå‘ç”Ÿä»€ä¹ˆ>15. å¯¹ å¯å˜ & ä¸å¯å˜ å¯¹è±¡è°ƒç”¨ <code>copy</code> & <code>mutableCopy</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><ul><li><p>â‘  æ‹·è´ç±»å‹ä¸åŒï¼š</p><ul><li><p>æ·±æ‹·è´ï¼šå¯¹ <code>å†…å®¹</code> è¿›è¡Œäº†æ‹·è´</p></li><li><p>æµ…æ‹·è´ï¼šå¯¹ <code>æŒ‡é’ˆ</code> è¿›è¡Œäº†æ‹·è´</p></li></ul><table><thead><tr><th align=center>&mdash;</th><th align=center>copy</th><th align=center>mutableCopy</th></tr></thead><tbody><tr><td align=center>NS*</td><td align=center><code>æµ…</code></td><td align=center>æ·±</td></tr><tr><td align=center>NSMutable*</td><td align=center>æ·±</td><td align=center>æ·±</td></tr></tbody></table></li><li><p>â‘¡ è¿”å›å¯¹è±¡ç±»å‹ä¸åŒï¼š</p><ul><li><p><code>NS* / NSMutalble* + copy = NS*</code></p></li><li><p><code>NS* / NSMutalble* + mutableCopy = NSMutalble*</code></p></li></ul></li></ul><p>æ€»è€Œè¨€ä¹‹æœ‰ä¸¤ä¸ªä¸ä¸€æ ·ï¼š</p><p>â‘  ä»…æœ‰å¯¹ ä¸å¯å˜ å¯¹è±¡æ‰§è¡Œ <code>copy</code> æ‰æ˜¯å‘ç”Ÿ æµ…æ‹·è´ï¼Œå…¶ä»–æƒ…å†µéƒ½æ˜¯æ·±æ‹·è´</p><p>â‘¡ æ‰§è¡Œ <code>copy</code> è¿”å› <code>ä¸å¯å˜å¯¹è±¡</code> ç±»å‹ï¼Œæ‰§è¡Œ <code>mutableCopy</code> è¿”å› <code>å¯å˜å¯¹è±¡</code> ç±»å‹</p><hr><h2 id=16-ä¸ºä»€ä¹ˆ-iboutlet-ä¿®é¥°çš„-uiview-ä¹Ÿé€‚ç”¨-weak-å…³é”®å­—>16. ä¸ºä»€ä¹ˆ <code>IBOutlet</code> ä¿®é¥°çš„ <code>UIView</code> ä¹Ÿé€‚ç”¨ <code>weak</code> å…³é”®å­—ï¼Ÿ</h2><p>åœ¨ <code>xib</code> æˆ–è€… <code>Sb</code> æ‹–æ§ä»¶æ—¶ï¼Œå…¶å®æ§ä»¶å°±åŠ è½½åˆ°äº†çˆ¶æ§ä»¶çš„ <code>subviews</code> æ•°ç»„é‡Œé¢ï¼Œè¿›è¡Œäº† <strong>å¼ºå¼•ç”¨</strong>ï¼Œå³ä½¿ä½¿ç”¨äº† <code>weak</code>ï¼Œä¹Ÿä¸é€ æˆå¯¹è±¡çš„é‡Šæ”¾ã€‚</p><hr><h2 id=17-nscache--nsdictionary>17. <code>NSCache</code> & <code>NSDictionary</code></h2><p>ä¸¤è€…éƒ½å¯ä»¥ä¿å­˜ <code>key-value</code>ï¼Œä½†æ˜¯æœ‰å¦‚ä¸‹ä¸åŒï¼š</p><ul><li><p>â‘  <code>NSCache</code> ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜</p></li><li><p>â‘¡ <code>NSCache</code> æ˜¯ <strong>çº¿ç¨‹å®‰å…¨</strong> çš„ï¼Œä¸åŒçº¿ç¨‹æ“ä½œä¸ä¼šæœ‰é—®é¢˜</p></li><li><p>â‘¢ <code>NSCache</code> ä¸ä¼šå¯¹ <code>key</code> è¿›è¡Œ <code>copy</code>ï¼Œè€Œ <code>NSDictionary</code> çš„ <code>key</code> éœ€è¦éµå®ˆ <code>&lt;NSCopying></code> åè®®ï¼Œä¼šå¯¹å…¶è¿›è¡Œ <code>copy</code></p></li></ul><hr><h2 id=18-designated-initializer>18. <code>Designated Initializer</code></h2><p>ç”¨æ¥ä¿®é¥°åˆå§‹åŒ–æ–¹æ³•ï¼Œæ˜¯æŒ‡å®šæ„é€ å™¨ï¼Œå…¶ä»–ä¾¿åˆ©æ„é€ å™¨<strong>å¿…é¡»</strong>è¦è°ƒç”¨å®ƒ</p><p>è¿™æ ·å¯ä»¥ä¿è¯æŸäº›å¿…è¦çš„å‡½æ•°è¢«è°ƒç”¨æˆ–è€…å±æ€§è¢«èµ‹å€¼</p><hr><h2 id=19-ç°åœ¨-xcode-æœ‰è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡äº†-autosynthesizeä»€ä¹ˆæ—¶å€™è¿˜éœ€è¦-synthesize>19. ç°åœ¨ <code>XCode</code> æœ‰è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡äº† ï¼ˆ<code>AutoSynthesize</code>ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™è¿˜éœ€è¦ <code>@synthesize</code>ï¼Ÿ</h2><p>å¦‚ä¸‹æƒ…å†µä¸ä¼šè‡ªåŠ¨åˆæˆï¼š</p><ul><li>åŒæ—¶é‡å†™äº† <code>setter</code> å’Œ <code>getter</code> æ—¶</li><li>é‡å†™äº†åªè¯»å±æ€§çš„ <code>getter</code> æ—¶</li><li>ä½¿ç”¨äº† <code>@dynamic</code> æ—¶</li><li>åœ¨ <code>@protocol</code> ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§</li><li>åœ¨ <code>category</code> ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§</li><li><strong>é‡è½½çš„å±æ€§</strong></li></ul><hr><h2 id=20-objc_msgsend-è¿‡ç¨‹>20. <code>objc_msgSend</code> è¿‡ç¨‹ï¼Ÿ</h2><ul><li>â‘  æŸ¥çœ‹ <code>receiver</code> æŒ‡é’ˆæ˜¯å¦ä¸º 0ï¼Œæ˜¯åˆ™è¿”å›</li><li>â‘¡ æŸ¥çœ‹è‡ªèº«çš„ <code>æ–¹æ³•ç¼“å­˜</code> æ˜¯å¦å‘½ä¸­ï¼Œå‘½ä¸­åˆ™æ‰§è¡Œï¼Œç„¶åè¿”å›ï¼Œå¦åˆ™ç»§ç»­</li><li>â‘¢ æŸ¥çœ‹è‡ªå·±çš„ <code>æ–¹æ³•åˆ—è¡¨</code> æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ‰§è¡Œï¼Œç„¶åè¿”å›ï¼Œå¦åˆ™ç»§ç»­</li><li>â‘¤ æŸ¥çœ‹çˆ¶ç±» (<code>superclass</code> æŒ‡é’ˆ) çš„ <code>æ–¹æ³•ç¼“å­˜</code> æ˜¯å¦å‘½ä¸­ï¼Œå‘½ä¸­åˆ™æ‰§è¡Œï¼Œç„¶åè¿”å›ï¼Œå¦åˆ™ç»§ç»­</li><li>â‘¥ æŸ¥çœ‹çˆ¶ç±»çš„ <code>æ–¹æ³•åˆ—è¡¨</code> æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ‰§è¡Œï¼Œç„¶åè¿”å›ï¼Œå¦åˆ™ç»§ç»­</li></ul><p>æœ€åä¸€åªæ‰¾åˆ° <code>NSObject</code>ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œ <code>åŠ¨æ€æ–¹æ³•è§£æ</code> & <code>æ¶ˆæ¯è½¬å‘</code> æœºåˆ¶ï¼ˆæ­¤æ—¶ä¼šç©¿ä»¶ä¸€ä¸ª <code>IMP</code>å¯¹è±¡ï¼ˆæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼‰ - <code>_objc_msgForward</code> æ¥åšæ¶ˆæ¯è½¬å‘ï¼‰</p><p>å¦‚æœåœ¨ <code>æ¶ˆæ¯è½¬å‘</code> çš„æœ€åä¸€æ­¥ï¼Œå³ <code>å®Œæ•´è½¬å‘</code> çš„ ç­¾åå¤„éƒ½è¿”å› <code>nil</code>ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<code>unrecognized selector sent to instance</code></p><p>PS: å¦‚æœåœ¨ <code>æ–¹æ³•åˆ—è¡¨</code> å­˜åœ¨ï¼Œä¸”ä¸å­˜åœ¨äº <code>ç¼“å­˜</code>ï¼Œåˆ™åŠ å…¥ <code>ç¼“å­˜</code></p><h3 id=åŠ¨æ€æ–¹æ³•è§£æ--æ¶ˆæ¯è½¬å‘><code>åŠ¨æ€æ–¹æ³•è§£æ</code> & <code>æ¶ˆæ¯è½¬å‘</code>ï¼š</h3><p>ä»¥ä¸‹æ˜¯ <code>_objc_msgForward</code> çš„è°ƒç”¨</p><h4 id=a-åŠ¨æ€æ–¹æ³•è§£æ>A. åŠ¨æ€æ–¹æ³•è§£æ</h4><p>è®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ª <strong>æ–°çš„å‡½æ•°</strong> å®ç°ï¼Œæ·»åŠ äº†ä¹‹åè¿”å› <code>YES</code> å°±ä¸ä¼šè¿›å…¥ä¸‹é¢æ¶ˆæ¯è½¬å‘çš„æµç¨‹äº†</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fooMethod</span>(<span style=color:#66d9ef>id</span> obj, <span style=color:#66d9ef>SEL</span> _cmd)  
{
    NSLog(<span style=color:#e6db74>@&#34;Doing foo&#34;</span>);
}

+ (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>resolveInstanceMethod:</span>(<span style=color:#66d9ef>SEL</span>)aSEL
{
    <span style=color:#66d9ef>if</span>(aSEL <span style=color:#f92672>==</span> <span style=color:#66d9ef>@selector</span>(foo:)){
        class_addMethod([self <span style=color:#66d9ef>class</span>], aSEL, (<span style=color:#66d9ef>IMP</span>)fooMethod, <span style=color:#e6db74>&#34;v@:&#34;</span>);
        <span style=color:#66d9ef>return</span> YES;
    }
    <span style=color:#66d9ef>return</span> [super resolveInstanceMethod];
}
</code></pre></div><h4 id=b-æ¶ˆæ¯è½¬å‘>B æ¶ˆæ¯è½¬å‘</h4><ul><li><p>å¿«é€Ÿè½¬å‘</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ª <strong>æ–°çš„å¯¹è±¡</strong> å»æ¥æ”¶è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡åˆ™ä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ <code>å®Œæ•´è½¬å‘</code> é€»è¾‘ï¼Œè¿”å› <code>nil</code> æˆ–è€… <code>self</code> éƒ½ä¼šæ‰§è¡Œ</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>- (<span style=color:#66d9ef>id</span>)<span style=color:#a6e22e>forwardingTargetForSelector:</span>(<span style=color:#66d9ef>SEL</span>)aSelector {
<span style=color:#66d9ef>if</span>(aSelector <span style=color:#f92672>==</span> <span style=color:#66d9ef>@selector</span>(foo:)){
    <span style=color:#66d9ef>return</span> [[BackupClass alloc] init];
}
<span style=color:#66d9ef>return</span> [super forwardingTargetForSelector:aSelector];
}
</code></pre></div></li><li><p>å®Œæ•´è½¬å‘</p><p>æä¾› <code>-(NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</code> ç»™å¼€å‘è€…å»åš <code>å‡½æ•°ç­¾å</code> ç„¶åç»„è£…æ–°çš„ <code>NSInvocation</code>ï¼Œæœ€ååœ¨ <code>-(void)forwardInvocation:(NSInvocation *)invocation</code> è°ƒç”¨è¯¥ <code>invocation</code>ï¼Œå®Œæˆå®Œæ•´è½¬å‘ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>forwardInvocation:</span>(NSInvocation <span style=color:#f92672>*</span>)invocation {
    <span style=color:#66d9ef>SEL</span> sel <span style=color:#f92672>=</span> invocation.selector;
    <span style=color:#66d9ef>if</span>([alternateObject respondsToSelector:sel]) {
        [invocation invokeWithTarget:alternateObject];
    } <span style=color:#66d9ef>else</span> {
        [self doesNotRecognizeSelector:sel];
    }
}

- (NSMethodSignature <span style=color:#f92672>*</span>)<span style=color:#a6e22e>methodSignatureForSelector:</span>(<span style=color:#66d9ef>SEL</span>)aSelector {
    NSMethodSignature <span style=color:#f92672>*</span>methodSignature <span style=color:#f92672>=</span> [super methodSignatureForSelector:aSelector];
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>methodSignature) {
        methodSignature <span style=color:#f92672>=</span> [NSMethodSignature signatureWithObjCTypes:<span style=color:#e6db74>&#34;v@:*&#34;</span>];
    }
    <span style=color:#66d9ef>return</span> methodSignature;
}
</code></pre></div><p>psï¼šæˆ‘ä»¬å¯ä»¥åœ¨ <code>- (void)forwardInvocation:(NSInvocation *)invocation</code> å°† <code>invocation</code> åˆ†å‘ç»™å¯¹ä¸ªå¯¹è±¡å»æ‰§è¡Œã€‚</p></li></ul><hr><h2 id=21-nsoperation--gcd>21. NSOperation & GCD</h2><p>1ï¼ŒNSOperationæ‹¥æœ‰æ›´å¤šçš„å‡½æ•°å¯ç”¨ï¼Œå…·ä½“æŸ¥çœ‹apiã€‚NSOperationQueue æ˜¯åœ¨GCDåŸºç¡€ä¸Šå®ç°çš„ï¼Œåªä¸è¿‡æ˜¯GCDæ›´é«˜ä¸€å±‚çš„æŠ½è±¡ã€‚</p><p>2ï¼Œåœ¨NSOperationQueueä¸­ï¼Œå¯ä»¥å»ºç«‹å„ä¸ªNSOperationä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>3ï¼ŒNSOperationQueueæ”¯æŒKVOã€‚å¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ï¼Œæ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰</p><p>4ï¼ŒGCD åªæ”¯æŒFIFO çš„é˜Ÿåˆ—ï¼Œè€ŒNSOperationQueueå¯ä»¥è°ƒæ•´é˜Ÿåˆ—çš„æ‰§è¡Œé¡ºåºï¼ˆé€šè¿‡è°ƒæ•´æƒé‡ï¼‰ã€‚NSOperationQueueå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†å¹¶å‘ã€NSOperationä¹‹é—´çš„ä¼˜å…ˆçº§ã€‚</p><h2 id=22-ä¿¡å·é‡>22. ä¿¡å·é‡</h2><p>æœ¬è´¨æ˜¯é€šè¿‡ <code>äº’æ–¥é”</code> å®ç°èµ„æºè®¡æ•°ï¼Œä¿è¯èµ„æºçš„è®¿é—®å®‰å…¨ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>dispatch_semaphore_create(<span style=color:#66d9ef>long</span> value); <span style=color:#75715e>// åˆ›å»ºä¸€ä¸ªsemaphoreã€€
</span><span style=color:#75715e></span>dispatch_semaphore_signal(dispatch_semaphore_t dsema); <span style=color:#75715e>// å‘é€ä¸€ä¸ªä¿¡å·
</span><span style=color:#75715e></span>dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout); <span style=color:#75715e>// ç­‰åˆ°ä¿¡å·
</span></code></pre></div><p><code>dispatch_semaphore_wait</code> å½“ä¿¡å·é‡ <code>å°äº 0</code> çš„æ—¶å€™ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°è¶…æ—¶ã€‚</p><hr><h2 id=23-èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡èƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ä¸ºä»€ä¹ˆ>23. èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h2><ul><li><p>ä¸èƒ½å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡</p></li><li><p>èƒ½å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡</p></li></ul><p>å› ä¸ºç¼–è¯‘åçš„ç±»å·²ç»æ³¨å†Œåœ¨ <code>runtime</code> ä¸­ï¼Œç±»ç»“æ„ä½“ä¸­çš„ <code>objc_ivar_list</code> å®ä¾‹å˜é‡çš„é“¾è¡¨å’Œ <code>instance_size</code> å®ä¾‹å˜é‡çš„ <strong>å†…å­˜å¤§å°å·²ç»ç¡®å®š</strong> ï¼ŒåŒæ—¶runtimeä¼šè°ƒç”¨ class_setIvarLayout æˆ– class_setWeakIvarLayout æ¥å¤„ç† <code>strong weak</code> å¼•ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å‘å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡</p><p>è¿è¡Œæ—¶åˆ›å»ºçš„ç±»æ˜¯å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡ï¼Œè°ƒç”¨ <code>class_addIvar</code>å‡½æ•°ã€‚ä½†æ˜¯å¾—åœ¨è°ƒç”¨<code>objc_allocateClassPair</code> ä¹‹åï¼Œ<code>objc_registerClassPair</code> ä¹‹å‰ï¼ŒåŸå› åŒä¸Šï¼ˆåœ¨ åˆ†é…ã€æ³¨å†Œ ä¹‹åï¼Œå®ä¾‹å˜é‡çš„ <strong>å†…å­˜å¤§å°å·²ç»ç¡®å®š</strong>ï¼‰</p><hr><h2 id=24-objc_msgforwawrd-æ˜¯åšä»€ä¹ˆçš„ç›´æ¥è°ƒç”¨çš„åæœ>24. <code>objc_msgForwawrd</code> æ˜¯åšä»€ä¹ˆçš„ï¼Ÿç›´æ¥è°ƒç”¨çš„åæœï¼Ÿ</h2><p><code>_objc_msgForward</code> æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆå’Œ <code>IMP</code> çš„ç±»å‹ä¸€æ ·ï¼‰ç”¨äºæ¶ˆæ¯è½¬å‘ï¼›å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œ<code>_objc_msgForward</code> ä¼šå°è¯•åšæ¶ˆæ¯è½¬å‘</p><p>åœ¨æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œ<code>objc_msgSend</code> çš„åŠ¨ä½œæ¯”è¾ƒæ¸…æ™°ï¼šé¦–å…ˆåœ¨ <code>Class</code> ä¸­çš„ç¼“å­˜æŸ¥æ‰¾ <code>IMP</code>ï¼ˆæ²¡æœ‰ç¼“å­˜åˆ™åˆå§‹åŒ–ç¼“å­˜ï¼‰å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™å‘çˆ¶ç±»çš„ <code>Class</code> æŸ¥æ‰¾ã€‚å¦‚æœä¸€ç›´æŸ¥æ‰¾åˆ°æ ¹ç±»ä»æ—§æ²¡æœ‰å®ç°ï¼Œåˆ™ç”¨ <code>_objc_msgForward</code> å‡½æ•°æŒ‡é’ˆä»£æ›¿ <code>IMP</code>ï¼Œæœ€åæ‰§è¡Œè¿™ä¸ª <code>IMP</code></p><p>ä¸€æ—¦è°ƒç”¨äº† <code>_objc_msgForward</code> ï¼Œå°†<strong>è·³è¿‡æŸ¥æ‰¾ <code>IMP</code> çš„è¿‡ç¨‹ï¼Œç›´æ¥è§¦å‘æ¶ˆæ¯è½¬å‘</strong>ï¼Œå¦‚æœè°ƒç”¨äº† <code>_objc_msgForward</code>ï¼Œå³ä½¿è¿™ä¸ªå¯¹è±¡ç¡®å®å·²ç»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ ä¹Ÿä¼šå‘Šè¯‰ <code>objc_msgSend</code>ï¼Œæˆ‘æ²¡æœ‰åœ¨è¿™ä¸ªå¯¹è±¡é‡Œæ‰¾åˆ°è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå¦‚æœç”¨ä¸å¥½ä¼šç›´æ¥å¯¼è‡´ç¨‹åº <code>Crash</code></p><hr><h3 id=25-ä¸‹é¢ä»£ç ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜>25. ä¸‹é¢ä»£ç ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) NSString <span style=color:#f92672>*</span>str;

dispatch_queue_t queue <span style=color:#f92672>=</span> dispatch_queue_create(<span style=color:#e6db74>&#34;parallel&#34;</span>, DISPATCH_QUEUE_CONCURRENT);
<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1000000</span> ; i<span style=color:#f92672>++</span>) {
    dispatch_async(queue, <span style=color:#f92672>^</span>{
        self.str <span style=color:#f92672>=</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;changzifuchaung:%d&#34;</span>,i];
    });
}
</code></pre></div><p>ä¼š <code>crash</code>ï¼ŒåŸå› æ˜¯ï¼š<strong>å¯¹è±¡è¢«é”€æ¯ï¼Œä½†æ˜¯æŒ‡å‘å®ƒçš„æŒ‡é’ˆä¾ç„¶å­˜åœ¨ï¼ˆé‡æŒ‡é’ˆï¼‰ï¼Œå†æ¬¡ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆè®¿é—®å¯¹è±¡çš„æ—¶å€™å°± crash äº† ã€EXC_BAD_ACCESSã€‘</strong></p><p>è§£é‡Šï¼š</p><p>åœ¨ ARC çš„æƒ…å†µä¸‹ï¼Œå¯¹ä½¿ç”¨ <code>strong</code> ä¿®é¥°çš„ <code>str</code> è¿›è¡Œèµ‹å€¼ï¼Œç›¸å½“äº MRC ä¸‹æ‰§è¡Œå¦‚ä¸‹ä»£ç </p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>setStr:</span>(NSString <span style=color:#f92672>*</span>)str{
    <span style=color:#66d9ef>if</span> (str <span style=color:#f92672>==</span> _str) <span style=color:#66d9ef>return</span>;
    <span style=color:#66d9ef>id</span> pre <span style=color:#f92672>=</span> _str;
    [str <span style=color:#66d9ef>retain</span>];<span style=color:#75715e>//1.å…ˆä¿ç•™æ–°å€¼
</span><span style=color:#75715e></span>    _str <span style=color:#f92672>=</span> str;<span style=color:#75715e>//2.å†è¿›è¡Œèµ‹å€¼
</span><span style=color:#75715e></span>    [pre <span style=color:#66d9ef>release</span>];<span style=color:#75715e>//3.é‡Šæ”¾æ—§å€¼
</span><span style=color:#75715e></span>}
</code></pre></div><p><code>DISPATCH_QUEUE_CONCURRENT</code> æ˜¯ å¹¶å‘é˜Ÿåˆ—ï¼Œå…è®¸å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚</p><p>crash çš„åœºæ™¯æ˜¯ï¼Œçº¿ç¨‹ A æ‰§è¡Œåˆ°äº† 1ï¼Œçº¿ç¨‹ B æ‰§è¡Œåˆ°äº† 3ï¼Œæ­¤æ—¶ A çš„ <code>pre</code> å·²ç»æ˜¯ é‡æŒ‡é’ˆ äº†ï¼Œç„¶åç­‰çº¿ç¨‹ 1 å†æ‰§è¡Œåˆ° 3ï¼Œå°±ä¼šå› ä¸ºä½¿ç”¨ é‡æŒ‡é’ˆ <code>pre</code> å¯¼è‡´ crashã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li>1ã€ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—</li></ul><p>å°† <code>set</code> æ–¹æ³•æ”¹æˆåœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œå°±è¡Œï¼Œè¿™æ ·å³ä½¿å¼‚æ­¥ï¼Œä½†æ‰€æœ‰ <code>block</code> æ“ä½œè¿½åŠ åœ¨é˜Ÿåˆ—æœ€åä¾æ¬¡æ‰§è¡Œ</p><ul><li>2ã€ä½¿ç”¨ <code>atomic</code></li></ul><p><code>atomic</code> å…³é”®å­—ç›¸å½“äºåœ¨ <code>setter</code> æ–¹æ³•åŠ é”ï¼Œè¿™æ ·æ¯æ¬¡æ‰§è¡Œ <code>setter</code> éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†è¿™åªæ˜¯å•ç‹¬é’ˆå¯¹ <code>setter</code> æ–¹æ³•è€Œè¨€çš„ç‹­ä¹‰çš„çº¿ç¨‹å®‰å…¨</p><ul><li>3ã€ä½¿ç”¨ <code>weak</code> å…³é”®å­—</li></ul><p><code>weak</code> çš„ <code>setter</code> æ²¡æœ‰ä¿ç•™æ–°å€¼çš„æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå¼•å‘é‡å¤é‡Šæ”¾ã€‚å½“ç„¶è¿™ä¸ªæ—¶å€™è¦çœ‹å…·ä½“æƒ…å†µèƒ½å¦ä½¿ç”¨ <code>weak</code>ï¼Œå¯èƒ½å€¼å¹¶ä¸æ˜¯æ‰€éœ€è¦çš„å€¼</p><p>4ã€ä½¿ç”¨äº’æ–¥é”ï¼Œä¿è¯æ•°æ®è®¿é—®çš„å”¯ä¸€æ€§</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC><span style=color:#66d9ef>@synchronized</span> (self) {
    self.str <span style=color:#f92672>=</span> [NSString stringWithFormat:<span style=color:#e6db74>@&#34;changzifuchaung:%d&#34;</span>,i];
}
</code></pre></div><ul><li>5ã€ä½¿ç”¨ <code>Tagged Pointer</code></li></ul><p><code>Tagged Pointer</code> æ˜¯è‹¹æœåœ¨ 64 ä½ç³»ç»Ÿå¼•å…¥çš„å†…å­˜æŠ€æœ¯ã€‚ç®€å•æ¥è¯´å°±æ˜¯å¯¹äº <code>NSString(å†…å­˜å°äº60ä½çš„å­—ç¬¦ä¸²) æˆ– NSNumber(å°äº2^31)</code>ï¼Œ64 ä½çš„æŒ‡é’ˆæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªç©ºé—´æ¥ç›´æ¥è¡¨ç¤ºå€¼ï¼Œè¿™æ ·çš„è¯å…¶å®ä¼šå°† <code>NSString</code> å’Œ <code>NSNumber</code> å¯¹è±¡ç”±ä¸€ä¸ªæŒ‡é’ˆè½¬æ¢æˆä¸€ä¸ªå€¼ç±»å‹ï¼Œè€Œå€¼ç±»å‹çš„ <code>setter</code> å’Œ <code>getter</code> åˆæ˜¯åŸå­çš„ï¼Œä»è€Œçº¿ç¨‹å®‰å…¨</p><hr><h2 id=26-uiimage-imagenamed-ç”Ÿæˆçš„å¯¹è±¡é‡Šæ”¾æ—¶æœº>26. <code>[UIImage imageNamed:]</code> ç”Ÿæˆçš„å¯¹è±¡é‡Šæ”¾æ—¶æœº</h2><p>ä½¿ç”¨ <code>imageNamed:</code> è¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„ <code>UIImage</code> å¯¹è±¡,ä¼šåœ¨åº”ç”¨çš„ <code>bundle</code> ä¸­å¯»æ‰¾å›¾ç‰‡,å¦‚æœæ‰¾åˆ°ï¼Œåˆ™ <code>Cache</code> åˆ°ç³»ç»Ÿç¼“å­˜ä¸­,ä½œä¸ºå†…å­˜çš„ <code>cache</code> ,è€Œç¨‹åºå‘˜æ˜¯æ— æ³•æ“ä½œ <code>cache</code> çš„,åªèƒ½ç”±ç³»ç»Ÿè‡ªåŠ¨å¤„ç†</p><p>åœ¨å¾ªç¯ä¸­å–è·å– <code>UIImage</code>ï¼Œæœ€å¥½åŠ ä¸Šä¸€ä¸ª <code>@autoreleasepool</code> è¿™æ ·å°±ä¸ä¼šå› ä¸ºå†…å­˜ä¸æ–­å¢å¤§è€Œå‘ç”Ÿ <code>memory warning</code></p><hr><h2 id=27-ä¸ºä»€ä¹ˆ-oc-ä¸­ä¼šæœ‰-metaclass>27. ä¸ºä»€ä¹ˆ OC ä¸­ä¼šæœ‰ <code>metaclass</code></h2><p><code>MetaClass</code> æ˜¯ç”¨æ¥å­˜æ”¾ç€ <code>ç±»æ–¹æ³•</code> çš„</p><p>æ ¹æ® ç»´åŸºç™¾ç§‘ çš„è§£é‡Š</p><pre><code>Metaclasses in Objective-C are almost the same as those in Smalltalk-80â€”not surprising since Objective-C borrows a lot from Smalltalk. Like Smalltalk, in Objective-C, the instance variables and methods are defined by an object's class. A class is an object, hence it is an instance of a metaclass.

(OCä¸­çš„Metaclasses åŸºæœ¬ä¸Šå’ŒSmalltalk-80ç›¸åŒ,é‰´äºOCä»Smalltalkä¸­å€Ÿé‰´äº†å¾ˆå¤šå› æ­¤è¿™å¹¶ä¸ä»¤äººå¹²åˆ°å¥‡æ€ªã€‚ç±»ä¼¼Smalltalk åœ¨OCä¸­å®ä¾‹çš„å˜é‡å’Œæ–¹æ³•è¢«å®šä¹‰åœ¨å¯¹è±¡çš„ç±»ä¸­,classä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡,äºæ˜¯classæ˜¯mataclassçš„ä¸€ä¸ªå®ä¾‹ã€‚)

Like Smalltalk, in Objective-C, class methods are simply methods called on the class object, hence a class's class methods must be defined as instance methods in its metaclass. Because different classes can have different sets of class methods, each class must have its own separate metaclass. Classes and metaclasses are always created as a pair: the runtime has functions objc_allocateClassPair() and objc_registerClassPair() to create and register class-metaclass pairs, respectively.

(ç±»ä¼¼Smalltalk,åœ¨OCä¸­ç±»æ–¹æ³•é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨,äºæ˜¯ä¸€ä¸ªç±»çš„ç±»æ–¹æ³•å¿…é¡»åœ¨metaclassä¸­ä»¥å®ä¾‹æ–¹æ³•çš„å½¢å¼å®šä¹‰ã€‚å› ä¸ºä¸åŒçš„ç±»å¯ä»¥åä¸åŒçš„ç±»æ–¹æ³•é›†åˆï¼Œæ¯ä¸€ä¸ªç±»å¿…é¡»æœ‰è‡ªå·±ç‹¬ç«‹çš„metaClassã€‚Classå’Œclass-metaClassä¸€èµ·è¢«åˆ›å»ºå’Œæ³¨å†Œ)

There are no names for the metaclasses; however, a pointer to any class object can be referred to with the generic type Class (similar to the type id being used for a pointer to any object). 

(metaClassæ²¡æœ‰åå­—,ç„¶è€Œ,æŒ‡å‘ä»»ä½•ç±»å¯¹è±¡çš„æŒ‡é’ˆå¯ä»¥ç”¨æ³›å‹ç±»å‹å¼•ç”¨)ï¼ˆç±»ä¼¼idå¯ä»¥æŒ‡å‘æ‰€æœ‰çš„å¯¹è±¡ï¼‰

Because class methods are inherited through inheritance, like Smalltalk, metaclasses must follow an inheritance scheme paralleling that of classes (e.g. if class A's parent class is class B, then A's metaclass's parent class is B's metaclass), except that of the root class.

(å› ä¸º,ç±»æ–¹æ³•é€šè¿‡ç»§æ‰¿è·å–,ç±»ä¼¼Smalltalk,å…ƒç±»å¿…é¡»éµå¾ªä¸ç±»ç±»ä¼¼çš„ç»§æ‰¿æ–¹æ¡ˆ

Unlike Smalltalk, the metaclass of the root class inherits from the root class (usually NSObject using the Cocoa framework) itself. This ensures that all class objects are ultimately instances of the root class, so that you can use the instance methods of the root class, usually useful utility methods for objects, on class objects themselves.

(ä¸Smalltalkä¸åŒ,æ ¹ç±»çš„metaclassç»§æ‰¿è‡ªæ ¹ç±»æœ¬èº«,è¿™å°±ç¡®ä¿äº†æ‰€æœ‰çš„ç±»å¯¹è±¡éƒ½æ˜¯æ ¹ç±»çš„å¯¹è±¡ã€‚ä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨æ ¹ç±»çš„å®ä¾‹æ–¹æ³•ï¼Œé€šå¸¸æ˜¯å¯¹è±¡çš„æœ‰ç”¨å®ç”¨å·¥å…·æ–¹æ³•ï¼Œä»¥åŠç±»å¯¹è±¡æœ¬èº«ã€‚)

Since metaclass objects do not behave differently (you cannot add class methods for a metaclass, so metaclass objects all have the same methods), they are all instances of the same classâ€”the metaclass of the root class (unlike Smalltalk). Thus, the metaclass of the root class is an instance of itself. The reason for this is that all metaclasses inherit from root class; hence, they must inherit the class methods of the root class.
</code></pre><hr><h2 id=28-performselector-withobject-afterdelay>28. <code>performSelector: withObject: afterDelay:</code></h2><p>è¯¥æ–¹æ³•ä¼šå¼€å¯ä¸€ä¸ª timer</p><p>å¦‚æœæ˜¯åœ¨å­çº¿ç¨‹ï¼Œåˆ™ä¸ä¼šè¿è¡Œ ï¼ˆå› ä¸ºå­çº¿ç¨‹é»˜è®¤ä¸å¼€å¯ Runloopï¼‰</p><p>æ‰€ä»¥æˆ‘ä»¬è¦ <code>[[NSRunLoop current] run]</code> ï¼Œè¿™ä¸ª timer æ‰ä¼šæ‰§è¡Œ</p><p>åœ¨æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡ä¹‹åï¼Œrunloop å°±ä¼šæ¨å‡ºï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡ä¸‹é¢çš„ä»»åŠ¡</p><hr><h2 id=29-æŸ¥æ‰¾ä¸¤ä¸ªè§†å›¾çš„å…¬å…±çˆ¶è§†å›¾>29. æŸ¥æ‰¾ä¸¤ä¸ªè§†å›¾çš„å…¬å…±çˆ¶è§†å›¾</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>- (nullable UIView <span style=color:#f92672>*</span>)<span style=color:#a6e22e>findNearestCommonSuperView:</span> (UIView <span style=color:#f92672>*</span>)a <span style=color:#a6e22e>b:</span> (UIView <span style=color:#f92672>*</span>)b {
    
    <span style=color:#66d9ef>if</span> (a.superview <span style=color:#f92672>==</span> nil <span style=color:#f92672>||</span> b.superview <span style=color:#f92672>==</span> nil) <span style=color:#66d9ef>return</span> nil;
    
    NSMutableArray <span style=color:#f92672>*</span>sa <span style=color:#f92672>=</span> [NSMutableArray array];
    NSMutableArray <span style=color:#f92672>*</span>sb <span style=color:#f92672>=</span> [NSMutableArray array];
    
    <span style=color:#66d9ef>for</span> (UIView <span style=color:#f92672>*</span>v <span style=color:#f92672>=</span> a.superview; v; v<span style=color:#f92672>=</span>v.superview) {
        [sa addObject: v];
    }
    
    <span style=color:#66d9ef>for</span> (UIView <span style=color:#f92672>*</span>v <span style=color:#f92672>=</span> b.superview; v; v<span style=color:#f92672>=</span>v.superview) {
        [sb addObject: v];
    }
    
    NSUInteger lenA <span style=color:#f92672>=</span> sa.count;
    NSUInteger lenB <span style=color:#f92672>=</span> sb.count;
    NSUInteger len <span style=color:#f92672>=</span> MIN(lenA, lenB);
    
    UIView <span style=color:#f92672>*</span>same <span style=color:#f92672>=</span> nil;
    <span style=color:#66d9ef>for</span> (NSInteger i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> len; i<span style=color:#f92672>++</span>) {
        <span style=color:#66d9ef>if</span> (sa[lenA <span style=color:#f92672>-</span> i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>!=</span> sb[lenB <span style=color:#f92672>-</span> i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>return</span> same;
        same <span style=color:#f92672>=</span> sa[lenA <span style=color:#f92672>-</span> i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
    }
    
    <span style=color:#66d9ef>return</span> same;
}
</code></pre></div><h2 id=30-ios-çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„>30. iOS çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ</h2><ul><li><p><code>NSThread</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>performSelectorOnMainThread:</span>(<span style=color:#66d9ef>SEL</span>)aSelector <span style=color:#a6e22e>withObject:</span>(nullable <span style=color:#66d9ef>id</span>)arg <span style=color:#a6e22e>waitUntilDone:</span>(<span style=color:#66d9ef>BOOL</span>)wait;

- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>performSelector:</span>(<span style=color:#66d9ef>SEL</span>)aSelector <span style=color:#a6e22e>onThread:</span>(NSThread <span style=color:#f92672>*</span>)thr <span style=color:#a6e22e>withObject:</span>(nullable <span style=color:#66d9ef>id</span>)arg <span style=color:#a6e22e>waitUntilDone:</span>(<span style=color:#66d9ef>BOOL</span>)wait API_AVAILABLE(macos(<span style=color:#ae81ff>10.5</span>), ios(<span style=color:#ae81ff>2.0</span>), watchos(<span style=color:#ae81ff>2.0</span>), tvos(<span style=color:#ae81ff>9.0</span>));
  
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>performSelectorInBackground:</span>(<span style=color:#66d9ef>SEL</span>)aSelector <span style=color:#a6e22e>withObject:</span>(nullable <span style=color:#66d9ef>id</span>)arg API_AVAILABLE(macos(<span style=color:#ae81ff>10.5</span>), ios(<span style=color:#ae81ff>2.0</span>), watchos(<span style=color:#ae81ff>2.0</span>), tvos(<span style=color:#ae81ff>9.0</span>));
</code></pre></div></li><li><p><code>GCD</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-OBJC data-lang=OBJC>
<span style=color:#75715e>//å¼€å¯ä¸€ä¸ªå…¨å±€é˜Ÿåˆ—çš„å­çº¿ç¨‹
</span><span style=color:#75715e></span>dispatch_async(dispatch_get_global_queue(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), <span style=color:#f92672>^</span>{
    <span style=color:#75715e>//1. å¼€å§‹è¯·æ±‚æ•°æ®
</span><span style=color:#75715e></span>    <span style=color:#75715e>//...
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 2. æ•°æ®è¯·æ±‚å®Œæ¯•
</span><span style=color:#75715e></span>    <span style=color:#75715e>//æˆ‘ä»¬çŸ¥é“UIçš„æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»å­çº¿ç¨‹å›è°ƒåˆ°ä¸»çº¿ç¨‹
</span><span style=color:#75715e></span>    dispatch_async(dispatch_get_main_queue(), <span style=color:#f92672>^</span>{
        <span style=color:#75715e>//æˆ‘å·²ç»å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°
</span><span style=color:#75715e></span>          
    });
});

<span style=color:#75715e>//çº¿ç¨‹å»¶è¿Ÿè°ƒç”¨ é€šä¿¡
</span><span style=color:#75715e></span>dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span style=color:#ae81ff>5.0</span> <span style=color:#f92672>*</span> NSEC_PER_SEC)), dispatch_get_main_queue(), <span style=color:#f92672>^</span>{
    NSLog(<span style=color:#e6db74>@&#34;## åœ¨ä¸»çº¿ç¨‹å»¶è¿Ÿ5ç§’è°ƒç”¨ ##&#34;</span>);
});
</code></pre></div></li></ul><hr><h2 id=31-volatile-å…³é”®å­—>31 <code>volatile</code> å…³é”®å­—</h2><p>ä¿®é¥°å˜é‡ï¼Œä»£è¡¨è¿™ä¸ªå˜é‡éšæ—¶æœ‰å¯èƒ½è¢«æ”¹å˜ï¼Œç¦æ­¢ç¼–è¯‘å™¨å’Œä¼˜åŒ–å™¨çš„ä¼˜åŒ–</p><p>æœ‰çš„æ—¶å€™ä¼˜åŒ–å™¨ä¼šä¸ºäº†æé«˜è¯»å–é€Ÿåº¦ï¼Œä¼šæŠŠå˜é‡å­˜åˆ°å¯„å­˜å™¨ä¸­</p><p>ä½¿ç”¨è¯¥å…³é”®å­—ï¼Œèƒ½è®©ç¼–è¯‘å™¨æ¯ä¸€æ¬¡éƒ½å»å†…å­˜ä¸­é‡æ–°è¯»å–è¿™ä¸ªå€¼</p><div class=blog-tags><a href=https://www.uiimage.com//tags/ios/>iOS</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f&text=iOS%20%e6%9d%82%e8%ae%b0&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f&title=iOS%20%e6%9d%82%e8%ae%b0" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f&title=iOS%20%e6%9d%82%e8%ae%b0" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f&title=iOS%20%e6%9d%82%e8%ae%b0" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.uiimage.com%2fpost%2fblog%2fios%2fios%2f&description=iOS%20%e6%9d%82%e8%ae%b0" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/blog/opengl-es/opengl-es-5-%E7%BB%98%E5%88%B6%E5%88%B0-texture-%E5%AE%9E%E7%8E%B0%E6%BB%A4%E9%95%9C%E9%93%BE/>OpenGL ES in iOS - 5 ç»˜åˆ¶åˆ° texture (å®ç°æ»¤é•œé“¾)</a></li><li><a href=/post/blog/opengl-es/opengl-es-4-%E7%BA%B9%E7%90%86%E9%87%87%E6%A0%B7%E8%AF%A6%E8%A7%A3/>OpenGL ES in iOS - 4. çº¹ç†é‡‡æ ·è¯¦è§£</a></li><li><a href=/post/blog/opengl-es/opengl-es-3-%E7%94%BB%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87/>OpenGL ES in iOS - 3. ç”»ä¸€å¼ å›¾ç‰‡</a></li><li><a href=/post/blog/%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/uiscreen-mainscreen.bounds-%E6%80%BB%E6%98%AF-320-480/>[UIScreen mainScreen].bounds æ€»æ˜¯ 320 480</a></li><li><a href=/post/blog/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/sdwebimage/>SDWebImage ç¬”è®°</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://www.uiimage.com/post/blog/ios/lock/ data-toggle=tooltip data-placement=top title="iOS ä¸­é”çš„æ¢ç©¶">&larr; Previous Post</a></li><li class=next><a href=https://www.uiimage.com/post/blog/%E9%9F%B3%E8%A7%86%E9%A2%91/yuv/ data-toggle=tooltip data-placement=top title=YUV>Next Post &rarr;</a></li></ul><span id=/post/blog/ios/ios/ class=leancloud_visitors data-flag-title="iOS æ‚è®°"><span class=post-meta-item-text>æ–‡ç« é˜…è¯»é‡</span>
<span class=leancloud-visitors-count>1000000</span><p></p></span><div id=vcomments></div><script src=//cdn1.lncld.net/static/js/3.0.4/av-min.js></script><script src=//unpkg.com/valine/dist/Valine.min.js></script><script type=text/javascript>new Valine({el:'#vcomments',appId:'Ld2PPgvVUNucDd8KP4B0kNNB-gzGzoHsz',appKey:'rijpKLUzykFXX0DGsbzHezk5',notify:false,verify:false,avatar:'robohash',placeholder:'æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ±‚å¤§ä½¬æŒ‡æ­£~',visitor:true});</script></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:18666269733@163.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/SourceKim title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://uiimage.com>Kim</a>
&nbsp;&bull;&nbsp;&copy;
2020
&nbsp;&bull;&nbsp;
<a href=https://www.uiimage.com/>Kim's Blog</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.69.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://www.uiimage.com/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.uiimage.com/js/load-photoswipe.js></script></body></html>